# Домашнее задание к занятию «Запуск приложений в K8S» `Горбачев Олег`

### Задание 1. Создать Deployment и обеспечить доступ к репликам приложения из другого Pod

1. Создать Deployment приложения, состоящего из двух контейнеров — nginx и multitool. Решить возникшую ошибку.
2. После запуска увеличить количество реплик работающего приложения до 2.
3. Продемонстрировать количество подов до и после масштабирования.
4. Создать Service, который обеспечит доступ до реплик приложений из п.1.
5. Создать отдельный Pod с приложением multitool и убедиться с помощью `curl`, что из пода есть доступ до приложений из п.1.

------

### Задание 2. Создать Deployment и обеспечить старт основного контейнера при выполнении условий

1. Создать Deployment приложения nginx и обеспечить старт контейнера только после того, как будет запущен сервис этого приложения.
2. Убедиться, что nginx не стартует. В качестве Init-контейнера взять busybox.
3. Создать и запустить Service. Убедиться, что Init запустился.
4. Продемонстрировать состояние пода до и после запуска сервиса.

------

### Решение задания 1. Создать Deployment и обеспечить доступ к репликам приложения из другого Pod

1. Создам отдельный Namespace для того, чтобы созданные в этом задании поды, деплойменты, сервисы работали отдельно от остальных, ранее созданных:

![img_1](IMG/img_1.png)

Пишу манифест Deployment приложения, состоящего из двух контейнеров — nginx и multitool. Поскольку у меня запущен Ingress с nginx в поде `nginx-ingress-microk8s-controller-tdkdf`, то порты 80, 443 будут заняты. В случае, если эти порты заняты, то запуск multitool потребует указания альтернативного порта. Для этого в манифест Deployment добавляю переменную с указанием порта 1180.

Ссылка на манифест Deployment - https://github.com/DemoniumBlack/fedorchukds-devops-33-38/blob/main/SRC/deployment.yaml

Запускаю Deployment:

![img_2](IMG/img_2.png)

Проверяю результат:

![img_3](IMG/img_3.png)

2. Сейчас у меня запущена одна реплика приложения nginx-multitool. Увеличу количество реплик до двух и проверю результат:

![img_4](IMG/img_4.png)

Видно, что количество реплик в AVAILABLE увеличилось до двух и обе запущены.

3. До масштабирования у меня был один под:

![img_5](IMG/img_5.png)

После масштабирования стало два пода:

![img_6](IMG/img_6.png)

4. Пишу манифест Service с именем nginx-multitool-svc в namespace netology. Применяю манифест:

![img_7](IMG/img_7.png)

Ссылка на манифест Service - https://github.com/DemoniumBlack/fedorchukds-devops-33-38/blob/main/SRC/service.yaml

Проверяю сервисы в namespace netology:

![img_8](IMG/img_8.png)

Сервис создан.

5. Пишу манифест отдельного пода multitool в namespace netology. Применяю манифест:

![img_9](IMG/img_9.png)

Ссылка на манифест с подом multitool - https://github.com/DemoniumBlack/fedorchukds-devops-33-38/blob/main/SRC/multitool.yaml

Проверяю поды в namespace netology:

![img_10](IMG/img_10.png)

Видно, что под с именем multitool был создан и запущен.

С помощью `curl`, проверяю, есть ли из пода multitool доступ до приложений из п.1.:

![img_11](IMG/img_11.png)

При обращении на порт 80 сервиса ответил запущенный nginx.

![img_12](IMG/img_12.png)

При обращении на порт 8080 сервиса ответил запущенный multitool.

---

### Решение задания 2. Создать Deployment и обеспечить старт основного контейнера при выполнении условий

1 - 2. Создаю манифест Deployment приложения nginx, который запустится только после запуска сервиса. В качестве Init-контейнера использую busybox:

![img_13](IMG/img_13.png)

Deployment создан, проверю запущен ли под:

![img_14](IMG/img_14.png)

Вижу, что под не запущен и находится в состоянии `Init:0/1`.

Ссылка на манифест Deployment - https://github.com/DemoniumBlack/fedorchukds-devops-33-38/blob/main/SRC/nginx-init-deploy.yaml

3 - 4. Создаю манифест Service, применяю его и проверю запустился ли под nginx:

![img_15](IMG/img_15.png)

После запуска сервиса, запустился под с nginx.

Ссылка на манифест Service - https://github.com/DemoniumBlack/fedorchukds-devops-33-38/blob/main/SRC/nginx-init-svc.yaml
